## 前言
Paxos算法的核心部分解决了分布式领域当中非常重要的基础问题，也就是共识问题；完整算法是用来实现状态机的算法。

## 共识问题
假设有一组进程，在这组进程中每一个进程都可以提议一个值。共识算法可以保证在所有这些提议的值中，只有唯一的一个值会被选中。如果没有被提议的值，那么就没有值没被选中。如果有一个值被选中，那么所有进程都应该能学习到这个值。

### 注意点
- 可以是任意多个进程。
- 所有进程都可以提议一个值。
- 所有进程都可以学习到被选中的值。

### 举例
有三个进程，分别是P1、P2、P3，它们要对一个值达成一致。P1要提议的值是1，P2要提议的值是2，P3要提议的值是3，它们同时调用consensus()方法，该方法实现一个**共识算法**，保证三个被提议的值当中只有一个值被选中。比如P2提议的值被选中，那么P1、P2调用consensus()方法返回的值就是2。并且，尽管P1后续又调用了consensus()方法，但是仍然返回被选中的值2。而且，即便P2后续再次提议一个值4，共识算法也要保证返回的是被选中的值2。

### 共识算法要求
1. 安全要求
    - 只有一个被提议的值可能被选中。
    - 只有唯一的一个值被选中。
    - 只有一个值实际上已经被选中，一个进程才能学习到这个值。
2. 存活要求
    - 某个被提议的值最终一定会被选中，并且如果一个值被选中，那么一个进程最终能够学习到这个值。

### 共识算法角色
Paxos consensus算法中有3个角色，分别是提议者（proposer）、接受者（acceptor）和学习者（learner）。

一个进程可以容纳多个角色：
- proposer角色负责提出一个值。
- acceptor角色负责选择一个值。
- learner角色负责学习到被选中的值。

### 共识算法的选择值和学习值的过程
Basic Paxos算法分为两个过程，即选择一个值和学习一个值。具体如下：
1. 在选择一个值的过程中，在一组proposer中，每一个proposer都可以提议任意一个值给一组acceptor，这组acceptor会从所有proposer提议的值中选中唯一的一个值。
2. 在学习一个值的过程中，learner从acceptor中学习到这个被选中的值。

## 基本概念
### 大多数
如果有2n+1个acceptor，那么n+1就是大多数（majority）。比如有3个acceptor，大多数就是2；有5个acceptor，大多数就是3；有7个acceptor，大多数就是4。按照2n+1这个公式来确定acceptor的个数，acceptor都会是奇数。当然，acceptor选择偶数个也是可以的，假设有m个acceptor，大多数就是m/2+1，比如有4个acceptor，那么大多数就是3。在实际中，一般会选择奇数个acceptor。
### 提议
算法中的另一个概念是提议（proposal），提议是包含一个提议编号和一个值的值对。我们后续用{n，v}表示一个提议，其中n是提议编号；v是一个任意值。例如{1，x}表示编号为1、要提议的值为x的一个提议。
### 提议编号
算法要求每个提议都包含一个提议编号（proposal number），并且这个提议编号是唯一且递增的，更准确地说，提议编号在一组进程中是全局唯一且递增的。Lamport给出了一种简单且有效的方法来生成这个提议编号：每个进程都被分配一个唯一的进程标识（processid）（假设为32位），每个进程都维护一个计数器（counter）（假设为32位），每发出一个提议都把计算器加1。

## 选择值过程
选择值的过程是一个两阶段的算法。

